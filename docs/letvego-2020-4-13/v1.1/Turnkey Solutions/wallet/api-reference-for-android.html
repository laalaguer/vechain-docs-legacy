

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>}); &mdash; VeChain Documentation Legacy 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> VeChain Documentation Legacy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">});</a></li>
<li><a class="reference internal" href="#id128">});</a></li>
<li><a class="reference internal" href="#id133">});</a></li>
<li><a class="reference internal" href="#id138">}</a></li>
<li><a class="reference internal" href="#id151">}</a></li>
<li><a class="reference internal" href="#id164">}</a></li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">VeChain Documentation Legacy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
      <li>});</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/letvego-2020-4-13/v1.1/Turnkey Solutions/wallet/api-reference-for-android.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>—
title: “API Reference for Android”
slug: “api-reference-for-android”
hidden: true
createdAt: “2019-04-15T10:45:47.936Z”
updatedAt: “2019-08-16T07:51:15.250Z”
—
The wallet function is implemented by calling SDK tool class: com.vechain.base.WalletUtils.</p>
<p>### SDK initialization</p>
<p>&gt; SDK initialization
Inherit the android.app.Application class and implement the following methods:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>java
protected void attachBaseContext(Context base) {</p>
<blockquote>
<div><blockquote>
<div><p>super.attachBaseContext(LanguageManager.setLocale(base));
SdkManager.initSdkManager(this);</p>
<p>//Set it as a test environment
WalletUtils.setNodeUrl(NodeUrl.TEST);</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p><a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
<p>This code is required：
<code class="docutils literal notranslate"><span class="pre">`java</span>
<span class="pre">SdkManager.initSdkManager(this);</span>
<span class="pre">`</span></code></p>
<p>#### Set node url</p>
<p>When app is released, it is set as a release environment:WalletUtils.setNodeUrl(NodeUrl.RELEASE);</p>
<p>Or if you have a corresponding node server, you can change it to your own node server:
<code class="docutils literal notranslate"><span class="pre">`java</span>
<span class="pre">NodeUrl.CUSTOM.setUrl(coustomUrl);</span>
<span class="pre">WalletUtils.setNodeUrl(NodeUrl.CUSTOM);</span>
<span class="pre">`</span></code></p>
<p>Switching test node url:
<code class="docutils literal notranslate"><span class="pre">`java</span>
<span class="pre">WalletUtils.setNodeUrl(NodeUrl.TEST);</span>
<span class="pre">`</span></code>
If nodeUrl is not set, the default value is NodeUrl.RELEASE.</p>
<p>### Get node url
<code class="docutils literal notranslate"><span class="pre">`java</span>
<span class="pre">String</span> <span class="pre">nodeUrl</span> <span class="pre">=</span> <span class="pre">WalletUtils.getNodeUrl();</span>
<span class="pre">`</span></code></p>
<p>#### Create Wallet
After entering the wallet password, the user can create the wallet through the following methods:</p>
<p><a href="#id9"><span class="problematic" id="id10">``</span></a><a href="#id11"><span class="problematic" id="id12">`</span></a>java
WalletUtils.OnCreateWalletCallback callback = new WalletUtils.OnCreateWalletCallback() {</p>
<blockquote>
<div><p>&#64;Override
public void onCreate(WalletUtils.Wallet wallet) {</p>
<blockquote>
<div><p>closeDialog();</p>
<dl class="docutils">
<dt>if (wallet == null) {</dt>
<dd>//fail
createFail();</dd>
<dt>}else {</dt>
<dd><p class="first">//success
words = wallet.getWords();
keystore = wallet.getKeystore();
String privateKey = wallet.getPrivateKey();
String address = wallet.getAddress();</p>
<p>//Keystore is saved in files or databases
FileUtils.writeCache(CreateWalletActivity.this, FileUtils.KEYSTORE_NAME, keystore);</p>
<p class="last">createSuccess();</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>};</p>
<p>WalletUtils.createWallet(password, callback);
<a href="#id13"><span class="problematic" id="id14">``</span></a>`
When the wallet is created successfully, the wallet object is obtained:com.vechain.base.WalletUtils.Wallet.If the creation fails, WalletUtils.Wallet wallet is null.
After successful creation, keystore security can be cached to local files or databases.</p>
<p>####  Create wallet with mnemonic words</p>
<p>When the user has mnemonic words, enter the mnemonic words and the password of the keystore of the wallet to import the wallet. The method of using the mnemonic words as follows:</p>
<p><a href="#id15"><span class="problematic" id="id16">``</span></a><a href="#id17"><span class="problematic" id="id18">`</span></a>java
WalletUtils.createWallet(words, password, new WalletUtils.OnCreateWalletCallback() {</p>
<blockquote>
<div><blockquote>
<div><p>&#64;Override
public void onCreate(WalletUtils.Wallet wallet) {</p>
<blockquote>
<div><p>closeLoading();
if(wallet!=null) {</p>
<blockquote>
<div><p>keystore = wallet.getKeystore();
if (!TextUtils.isEmpty(keystore))</p>
<blockquote>
<div>//Keystore is saved in files or databases
//FileUtils.writeCache(getContext(), FileUtils.KEYSTORE_NAME, keystore);</div></blockquote>
<p>//success
onImportSuccess();</p>
</div></blockquote>
<dl class="docutils">
<dt>}else{</dt>
<dd>//errors
onImportWalletError(false);</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>});</p>
</div></blockquote>
<p><a href="#id19"><span class="problematic" id="id20">``</span></a><a href="#id21"><span class="problematic" id="id22">`</span></a></p>
<p>#### Verify the mnemonic words</p>
<p><a href="#id23"><span class="problematic" id="id24">``</span></a><a href="#id25"><span class="problematic" id="id26">`</span></a>java
/**</p>
<blockquote>
<div><ul class="simple">
<li>Whether mnemonic words is valid or not</li>
<li></li>
<li>&#64;param The range of mnemonic words is limited to 12, 15, 18, 21 and 24.</li>
<li>&#64;return Is it valid or not</li>
</ul>
<p><a href="#id27"><span class="problematic" id="id28">*</span></a>/</p>
</div></blockquote>
<p>public static boolean isValidMnemonicWords(List&lt;String&gt; words)
<a href="#id29"><span class="problematic" id="id30">``</span></a><a href="#id31"><span class="problematic" id="id32">`</span></a></p>
<p>#### Verify keystore format</p>
<p><a href="#id33"><span class="problematic" id="id34">``</span></a><a href="#id35"><span class="problematic" id="id36">`</span></a>java
/**</p>
<blockquote>
<div><ul class="simple">
<li>Whether keystore for JSON format is correct or not</li>
<li></li>
<li>&#64;param keystore JSON encryption format for user wallet private key</li>
<li>&#64;return Is the format correct or not?</li>
</ul>
<p><a href="#id37"><span class="problematic" id="id38">*</span></a>/</p>
</div></blockquote>
<p>public static boolean isValidKeystore(String keystore)
<a href="#id39"><span class="problematic" id="id40">``</span></a><a href="#id41"><span class="problematic" id="id42">`</span></a></p>
<p>#### Get address from keystore</p>
<p><a href="#id43"><span class="problematic" id="id44">``</span></a><a href="#id45"><span class="problematic" id="id46">`</span></a>java
/**</p>
<blockquote>
<div><ul class="simple">
<li>Get the address from the keystore</li>
<li></li>
<li>&#64;param keystoreJson</li>
<li>&#64;return wallet address</li>
</ul>
<p><a href="#id47"><span class="problematic" id="id48">*</span></a>/</p>
</div></blockquote>
<p>public static String getAddress(String keystoreJson)
<a href="#id49"><span class="problematic" id="id50">``</span></a><a href="#id51"><span class="problematic" id="id52">`</span></a></p>
<p>#### Verify the keystore with password</p>
<blockquote>
<div>Verify that the keystore password is correct or not when the keystore is cached into local file or database.</div></blockquote>
<p><a href="#id53"><span class="problematic" id="id54">``</span></a><a href="#id55"><span class="problematic" id="id56">`</span></a>java
WalletUtils.verifyKeystorePassword(keystoreJson, password, new WalletUtils.OnVerifyPasswordCallback() {</p>
<blockquote>
<div><blockquote>
<div><p>&#64;Override
public void onCheckPassword(boolean success) {</p>
<blockquote>
<div><dl class="docutils">
<dt>if (success) {</dt>
<dd><blockquote class="first">
<div>//success
onImportSuccess();</div></blockquote>
<p class="last">//Keystore is saved in files or databases
//FileUtils.writeCache(getActivity(), FileUtils.KEYSTORE_NAME, keystoreJson);</p>
</dd>
<dt>} else {</dt>
<dd>//errors
onImportWalletError();</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>});</p>
</div></blockquote>
<p><a href="#id57"><span class="problematic" id="id58">``</span></a><a href="#id59"><span class="problematic" id="id60">`</span></a></p>
<p>####  Modify password of keystore</p>
<p><a href="#id61"><span class="problematic" id="id62">``</span></a><a href="#id63"><span class="problematic" id="id64">`</span></a>java
WalletUtils.modifyKeystorePassword(keystoreJson, oldPassword, newPassword,</p>
<blockquote>
<div><dl class="docutils">
<dt>new WalletUtils.OnModifyKeystorePasswordCallback() {</dt>
<dd><p class="first">&#64;Override
public void onModifyResult(String newKeystore) {</p>
<blockquote>
<div><dl class="docutils">
<dt>if (!TextUtils.isEmpty(newKeystore)) {</dt>
<dd>keystoreJson = newKeystore;</dd>
</dl>
<p>//Keystore is saved in files or databases
//FileUtils.writeCache(getBaseContext(), FileUtils.KEYSTORE_NAME, newKeystore);</p>
<blockquote>
<div>//success
onModifyPasswordSuccess();</div></blockquote>
<dl class="docutils">
<dt>} else {</dt>
<dd>//errors
onModifyPasswordError();</dd>
</dl>
<p>}</p>
</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
<p>});</p>
</div></blockquote>
<p><a href="#id65"><span class="problematic" id="id66">``</span></a><a href="#id67"><span class="problematic" id="id68">`</span></a></p>
<p>####  Decrypt keystore</p>
<p><a href="#id69"><span class="problematic" id="id70">``</span></a><a href="#id71"><span class="problematic" id="id72">`</span></a>java
/**
* Keystore decrypts private key
*
* &#64;param keystoreJson
* &#64;param password
* &#64;param callback private key
<a href="#id73"><span class="problematic" id="id74">*</span></a>/
public static void decryptKeystore(final String keystoreJson, final String password,</p>
<blockquote>
<div>final DecryptKeystoreCallback callback)</div></blockquote>
<p><a href="#id75"><span class="problematic" id="id76">``</span></a><a href="#id77"><span class="problematic" id="id78">`</span></a></p>
<p>#### Encrypted private key</p>
<p><a href="#id79"><span class="problematic" id="id80">``</span></a><a href="#id81"><span class="problematic" id="id82">`</span></a>java
/**
* Private key encryption generates keystore
*
* &#64;param privateKey
* &#64;param password
* &#64;param callback keystore
<a href="#id83"><span class="problematic" id="id84">*</span></a>/
public static void encryptPrivateKey(final String privateKey, final String password,</p>
<blockquote>
<div>final EncryptPrivateKeyCallback callback)</div></blockquote>
<p><a href="#id85"><span class="problematic" id="id86">``</span></a><a href="#id87"><span class="problematic" id="id88">`</span></a></p>
<p>#### Get checksum address</p>
<p><a href="#id89"><span class="problematic" id="id90">``</span></a><a href="#id91"><span class="problematic" id="id92">`</span></a>java
/**</p>
<blockquote>
<div><ul class="simple">
<li>Generate wallet addresses in check format</li>
<li></li>
<li>&#64;param address Wallet address</li>
<li>&#64;return Address with Check Format</li>
</ul>
<p><a href="#id93"><span class="problematic" id="id94">*</span></a>/</p>
</div></blockquote>
<p>public static String getChecksumAddress(String address)
<a href="#id95"><span class="problematic" id="id96">``</span></a><a href="#id97"><span class="problematic" id="id98">`</span></a></p>
<p>#### Sign Message</p>
<p><a href="#id99"><span class="problematic" id="id100">``</span></a><a href="#id101"><span class="problematic" id="id102">`</span></a>java
/**</p>
<blockquote>
<div><ul class="simple">
<li>Wallet signature of information</li>
<li></li>
<li>&#64;param keystore Wallet keystore JSON format</li>
<li>&#64;param password Keystore password</li>
<li>&#64;param message Prepare the message to be signed</li>
<li>&#64;return Signature information of byte [] of length 65</li>
<li>&#64;throws CipherException</li>
<li>&#64;throws ValidationException</li>
</ul>
<p><a href="#id103"><span class="problematic" id="id104">*</span></a>/</p>
</div></blockquote>
<dl class="docutils">
<dt>public static byte[] sign(String keystore, String password,</dt>
<dd>byte[] message) throws CipherException, ValidationException</dd>
</dl>
<p><a href="#id105"><span class="problematic" id="id106">``</span></a><a href="#id107"><span class="problematic" id="id108">`</span></a></p>
<p>#### Recover address</p>
<p><a href="#id109"><span class="problematic" id="id110">``</span></a><a href="#id111"><span class="problematic" id="id112">`</span></a>java
/**</p>
<blockquote>
<div><ul class="simple">
<li>Recovering the address through the message and signature</li>
<li></li>
<li>&#64;param message   Data to be signed</li>
<li>&#64;param signature  length is 65 bytes</li>
<li>&#64;return Wallet address</li>
</ul>
<p><a href="#id113"><span class="problematic" id="id114">*</span></a>/</p>
</div></blockquote>
<p>public static String recoverAddress(byte[] message, byte[] signature)
<a href="#id115"><span class="problematic" id="id116">``</span></a><a href="#id117"><span class="problematic" id="id118">`</span></a></p>
<p>####  Get reference of block chain</p>
<p><a href="#id119"><span class="problematic" id="id120">``</span></a><a href="#id121"><span class="problematic" id="id122">`</span></a>java
WalletUtils.getBlockReference(new WalletUtils.OnGetBlockReferenceCallback() {</p>
<blockquote>
<div><p>&#64;Override
public void onGetBlockReferenceResult(String blockRef) {</p>
<blockquote>
<div>blockReference = blockRef;</div></blockquote>
<p>}</p>
</div></blockquote>
<div class="section" id="id123">
<h1>});<a class="headerlink" href="#id123" title="Permalink to this headline">¶</a></h1>
<p>####  Get chainTag of block chain</p>
<p><a href="#id124"><span class="problematic" id="id125">``</span></a><a href="#id126"><span class="problematic" id="id127">`</span></a>java
WalletUtils.getChainTag(new WalletUtils.OnGetChainTagCallback() {</p>
<blockquote>
<div><p>&#64;Override
public void onGetChainTagResult(String chainTag) {</p>
<blockquote>
<div>this.chainTag = chainTag;</div></blockquote>
<p>}</p>
</div></blockquote>
</div>
<div class="section" id="id128">
<h1>});<a class="headerlink" href="#id128" title="Permalink to this headline">¶</a></h1>
<p>####  Sign and send Transaction</p>
<p><a href="#id129"><span class="problematic" id="id130">``</span></a><a href="#id131"><span class="problematic" id="id132">`</span></a>java
WalletUtils.signAndSendTransfer(keystoreJson, password, transferParameter, new WalletUtils.OnSignCallback() {</p>
<blockquote>
<div><p>&#64;Override
public void onSignResult(String txId) {</p>
<blockquote>
<div><dl class="docutils">
<dt>if (transferResultListener != null)</dt>
<dd>transferResultListener.onTransferResult(txId);</dd>
</dl>
</div></blockquote>
<p>}</p>
</div></blockquote>
</div>
<div class="section" id="id133">
<h1>});<a class="headerlink" href="#id133" title="Permalink to this headline">¶</a></h1>
<p>After the transaction is sent, txId can be acquired. Through txId, the transaction status can be further acquired, and the success of the transaction can be confirmed by multiple blocks.</p>
<p>##### Examples of transaction parameter construction</p>
<p><a href="#id134"><span class="problematic" id="id135">``</span></a><a href="#id136"><span class="problematic" id="id137">`</span></a>java
String hexNonce = null;
byte[] nonceBytes = new byte[8];
Random random = new Random();
random.nextBytes(nonceBytes);
hexNonce = Numeric.toHexString(nonceBytes);</p>
<p>TransferParameter.Builder builder = new TransferParameter.Builder();
TransferParameter transferParameter = null;
try {</p>
<blockquote>
<div><dl class="docutils">
<dt>transferParameter = builder.setClauseList(clauseList)</dt>
<dd>.setGas(gas)
.setChainTag(chainTag)
.setBlockReference(blockReference)
.setNonce(hexNonce)
.build();</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>} catch (ParameterException e) {</dt>
<dd>e.printStackTrace();</dd>
</dl>
</div>
<div class="section" id="id138">
<h1>}<a class="headerlink" href="#id138" title="Permalink to this headline">¶</a></h1>
<p>TransferParameter attribute description：</p>
<ul class="simple">
<li>clauses : List&lt;Clause&gt; - Multi-transaction information</li>
<li>gas : String  - Enforces the specified number as the maximum gas that can be consumed for the transaction</li>
<li>chainTag : String - Genesis block ID last byte hexadecimal</li>
<li>blockReference : String - Refer to the last 8 bytes of blockId in hexadecimal</li>
<li>nonce : String  - The random number of trading entities. Changing Nonce can make the transaction have different IDs, which can be used to accelerate the trader.</li>
<li>gasPriceCoef : String - This value adjusts the priority of the transaction, and the current value range is between 0 and 255 (decimal),The default value is “0”</li>
<li>expiration : String - Deal expiration/expiration time in blocks,The default value is “720”</li>
<li>dependsOn :String - The ID of the dependent transaction. If the field is not empty, the transaction will be executed only if the transaction specified by it already exists.The default value is null.</li>
<li>reserveds: List  -  Currently empty, reserve fields. Reserved fields for backward compatibility,The default value is null</li>
</ul>
<p>####  Sign transaction</p>
<p><a href="#id139"><span class="problematic" id="id140">``</span></a><a href="#id141"><span class="problematic" id="id142">`</span></a>java
WalletUtils.signTransfer(keystoreJson, password, transferParameter, new WalletUtils.OnSignCallback() {</p>
<blockquote>
<div><p>&#64;Override
public void onSignResult(String raw) {</p>
<blockquote>
<div>//raw: RLP encode data and signature</div></blockquote>
<p>}</p>
</div></blockquote>
<p>});</p>
<p><a href="#id143"><span class="problematic" id="id144">``</span></a><a href="#id145"><span class="problematic" id="id146">`</span></a></p>
<p>####  Support DApp development environment in Webview
To support the Dapp function, WebView needs the following initialization before opening Dapp.
Initialization is mainly JS injected into connex and web3.
[connex reference.](<a class="reference external" href="https://github.com/vechain/connex/blob/master/docs/api.md/">https://github.com/vechain/connex/blob/master/docs/api.md/</a>)</p>
<p><code class="docutils literal notranslate"><span class="pre">`java</span>
<span class="pre">WebSettings</span> <span class="pre">set</span> <span class="pre">=</span> <span class="pre">webView.getSettings();</span>
<span class="pre">set.setJavaScriptEnabled(true);</span>
<span class="pre">set.setDomStorageEnabled(true);</span>
<span class="pre">String</span> <span class="pre">appCachePath</span> <span class="pre">=</span> <span class="pre">getApplication().getCacheDir().getAbsolutePath();</span>
<span class="pre">set.setAppCachePath(appCachePath);</span>
<span class="pre">set.setDatabaseEnabled(true);</span>
<span class="pre">CookieSyncManager.createInstance(this);</span>
<span class="pre">CookieManager</span> <span class="pre">cookieManager</span> <span class="pre">=</span> <span class="pre">CookieManager.getInstance();</span>
<span class="pre">cookieManager.setAcceptCookie(true);</span>
<span class="pre">webView.setWebChromeClient(new</span> <span class="pre">MyWebChromeClient());</span>
<span class="pre">`</span></code>
MyWebChromeClient is implemented as follows. If you want to implement WebChromeClient, your WebChromeClient must inherit DappWebChromeClient.</p>
<p><a href="#id147"><span class="problematic" id="id148">``</span></a><a href="#id149"><span class="problematic" id="id150">`</span></a>java
class MyWebChromeClient extends DappWebChromeClient {</p>
<blockquote>
<div><p>&#64;Override
public void onReceivedTitle(WebView view, String title) {</p>
<blockquote>
<div><p>//must be implemented to support the DApp environment
super.onReceivedTitle(view,title);</p>
<p>//……</p>
</div></blockquote>
<p>}</p>
<p>&#64;Override
public boolean onJsPrompt(WebView view, String url, String message, String defaultValue, JsPromptResult result) {</p>
<blockquote>
<div>//must be implemented to support the DApp environment
return super.onJsPrompt(view,url,message,defaultValue,result);</div></blockquote>
<p>}</p>
</div></blockquote>
</div>
<div class="section" id="id151">
<h1>}<a class="headerlink" href="#id151" title="Permalink to this headline">¶</a></h1>
<p>At the same time, the wallet must be initialized before calling WebView to open Url’s corresponding Dapp, as follows：Implementing DAppAction Interface</p>
<p><a href="#id152"><span class="problematic" id="id153">``</span></a><a href="#id154"><span class="problematic" id="id155">`</span></a>java
public class DAppWebActivity extends Activity implements DAppAction{</p>
<blockquote>
<div><p>&#64;Override
public void onCreate(Bundle savedInstanceState) {</p>
<blockquote>
<div>super.onCreate(savedInstanceState);
…
//Support for DApp must be initialized
WalletUtils.initDApp(this);
…</div></blockquote>
<p>}</p>
<p>…</p>
<blockquote>
<div><blockquote>
<div>/**</div></blockquote>
<ul class="simple">
<li>Interfaces that must be implemented to support the DApp environment</li>
<li>App developer implementation when dapp calls checkOwn address function</li>
<li>&#64;param address Address from dapp</li>
<li>&#64;param callback Callback after the end</li>
</ul>
<p><a href="#id156"><span class="problematic" id="id157">*</span></a>/</p>
</div></blockquote>
<p>public void onCheckOwnAddress(String address, OwnedAddressCallback callback){</p>
<blockquote>
<div><p>//Read the wallet keystore from a file or database
String keystore = FileUtils.readCache(this, FileUtils.KEYSTORE_NAME);
final String walletAddress = WalletUtils.getAddress(keystore);
boolean isOwn = walletAddress.equals(address);
if(callback!=null)</p>
<blockquote>
<div>callback.onOwned(isOwn);</div></blockquote>
</div></blockquote>
<p>}</p>
<dl class="docutils">
<dt>/**</dt>
<dd><ul class="first simple">
<li>Interfaces that must be implemented to support the DApp environment</li>
<li></li>
<li>&#64;param message  Information to be signed</li>
<li>&#64;param callback Callback method after signature information is completed</li>
</ul>
<p class="last"><a href="#id158"><span class="problematic" id="id159">*</span></a>/</p>
</dd>
</dl>
<p>&#64;Override
public void onCertificate(final String message, final String signer,final CertificateCallback callback) {</p>
<blockquote>
<div><p>//Interfaces that must be implemented to support the DApp environment
//Read the wallet keystore from a file or database
String keystore = FileUtils.readCache(this, FileUtils.KEYSTORE_NAME);
final String walletAddress = WalletUtils.getAddress(keystore);</p>
<p>// if signer not null, Enforces the specified address to sign the certificate
if(signer!=null &amp;&amp; !signer.equalsIgnoreCase(walletAddress)){</p>
<blockquote>
<div>if (callback != null) callback.onCertificate(null,null);
return;</div></blockquote>
<p>}</p>
<p>//Prompt user to enter wallet password
CertificatePasswordDialog.takePassword(this, keystore, new CertificateSignListener() {</p>
<blockquote>
<div><p>&#64;Override
public void deliverCertificate(String signature) {</p>
<blockquote>
<div>// notify DApp
if(callback!=null)callback.onCertificate(walletAddress,signature);</div></blockquote>
<p>}</p>
</div></blockquote>
<p>});</p>
</div></blockquote>
<p>}</p>
<dl class="docutils">
<dt>/**</dt>
<dd><ul class="first simple">
<li>Interfaces that must be implemented to support the DApp environment</li>
<li></li>
<li>&#64;param clauses</li>
<li>&#64;param gas</li>
<li>&#64;param callback Transaction Sending Completion Callback Method</li>
</ul>
<p class="last"><a href="#id160"><span class="problematic" id="id161">*</span></a>/</p>
</dd>
</dl>
<p>&#64;Override
public void onTransfer(List&lt;Clause&gt; clauses, String gas, final String signer,final TransferResultCallback callback) {</p>
<blockquote>
<div><p>//Read the wallet keystore from a file or database
String keystore = FileUtils.readCache(this, FileUtils.KEYSTORE_NAME);
final String address = WalletUtils.getAddress(keystore);</p>
<p>// if signer not null, Enforces the specified address to sign the transaction
if(signer!=null &amp;&amp; !signer.equalsIgnoreCase(address)){</p>
<blockquote>
<div>if(callback!=null)callback.onTransferResult(null,null);
return;</div></blockquote>
<p>}</p>
<dl class="docutils">
<dt>PasswordDialog.showInputPassword(this, keystore, clauses, gas, new TransferResultListener() {</dt>
<dd><p class="first">&#64;Override
public void onTransferResult(String result) {</p>
<blockquote>
<div>if(callback!=null)callback.onTransferResult(address,result);</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
<p>});</p>
</div></blockquote>
<p>}</p>
<dl class="docutils">
<dt>/**</dt>
<dd><ul class="first simple">
<li>Interfaces that must be implemented to support the DApp environment</li>
<li></li>
<li>Get a list of wallet addresses from a local file or database</li>
<li></li>
<li>&#64;param callback Address list to DApp</li>
</ul>
<p class="last"><a href="#id162"><span class="problematic" id="id163">*</span></a>/</p>
</dd>
</dl>
<p>&#64;Override
public void onGetWalletAddress(GetWalletAddressCallback callback) {</p>
<blockquote>
<div><p>//Get the wallet keystore from the local database or file cache
String keystore = FileUtils.readCache(this, FileUtils.KEYSTORE_NAME);
String address = WalletUtils.getAddress(keystore);</p>
<p>//DApp must set addresses
List&lt;String&gt; addresses = new ArrayList&lt;&gt;();
addresses.add(address);</p>
<p>//Callback method must be executed after completion
if (callback != null) callback.setWalletAddress(addresses);</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
</div>
<div class="section" id="id164">
<h1>}<a class="headerlink" href="#id164" title="Permalink to this headline">¶</a></h1>
<p>When closing WebView, you can do the following:</p>
<p><a href="#id165"><span class="problematic" id="id166">``</span></a><a href="#id167"><span class="problematic" id="id168">`</span></a>java
protected void onDestroy() {</p>
<blockquote>
<div><blockquote>
<div><dl class="docutils">
<dt>if (webView != null)</dt>
<dd>webView.destroy();</dd>
</dl>
<p>webView = null;
//Memory Recycling to Prevent Memory Leakage
WalletUtils.onDAppDestroy();</p>
<p>super.onDestroy();</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p><a href="#id169"><span class="problematic" id="id170">``</span></a><a href="#id171"><span class="problematic" id="id172">`</span></a></p>
<p>## Several main data structures</p>
<p>### 1.keystore</p>
<p><a href="#id173"><span class="problematic" id="id174">``</span></a><a href="#id175"><span class="problematic" id="id176">`</span></a>java
/**
*  Keystore is a json string. Its file structure is as follows:
*
*  — — — — — — — — — — — — — — — — — — — — — — — — — — ——
*      {
*          “version”: 3,
*          “id”: “F56FDA19-FB1B-4752-8EF6-E2F50A93BFB8”,
*          “kdf”: “scrypt”,
*          “mac”: “9a1a1db3b2735c36015a3893402b361d151b4d2152770f4a51729e3ac416d79f”,
*          “cipher”: “aes-128-ctr”
*          “address”: “ea8a62180562ab3eac1e55ed6300ea7b786fb27d”
*          “crypto”: {
*                      “ciphertext”: “d2820582d2434751b83c2b4ba9e2e61d50fa9a8c9bb6af64564fc6df2661f4e0”,
*                      “cipherparams”: {
*                                          “iv”: “769ef3174114a270f4a2678f6726653d”
*                                      },
*                      “kdfparams”: {
*                              “r”: 8,
*                              “p”: 1,
*                              “n”: 262144,
*                              “dklen”: 32,
*                              “salt”: “67b84c3b75f9c0bdf863ea8be1ac8ab830698dd75056b8133350f0f6f7a20590”
*                      },
*          },
*      }
*
*  — — — — — — — — — — — — — — — — — — — — — — — — — — ——
*  Field description:
*          version: This is a version information, when you decryption, you should use the same version.
*          id: You can ignore.
*          Kdf: This is a encryption function.
*          mac: This is the mac deveice infomation.
*          cipher: Describes the encryption algorithm used.
*          address：The wallet address.
*          crypto: This section is the main encryption area.
*
*  If you want to recover a wallet by keystore, you should have the correct password.
*
<a href="#id177"><span class="problematic" id="id178">*</span></a>/</p>
<p><a href="#id179"><span class="problematic" id="id180">``</span></a><a href="#id181"><span class="problematic" id="id182">`</span></a></p>
<p>### 2.Hexadecimal must start with 0x.</p>
<p>### 3.Address : 20 bytes hex string and start with 0x.</p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, VeChain Developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>